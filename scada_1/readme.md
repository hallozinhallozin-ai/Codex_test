Универсальный GUI для управления устройствами v4.7
Описание

Этот проект представляет собой универсальный графический клиент на базе CustomTkinter для мониторинга и управления различными типами устройств по сети. Клиент использует асинхронный WebSocket API для обмена данными в реальном времени и поддерживает иерархическую структуру для удобной организации большого количества устройств по местам их установки (локациям).

На данный момент реализована поддержка двух типов устройств:

Шторы с управлением по протоколу WebSocket.

Промышленные вентиляционные системы с управлением по Modbus, данные которых транслируются через WebSocket.

Ключевые возможности

Универсальность: Архитектура позволяет легко добавлять новые типы устройств с уникальным интерфейсом и логикой управления.

Иерархический интерфейс: Устройства группируются по локациям в древовидной структуре, что обеспечивает удобную навигацию и масштабируемость системы.

Регулируемая панель: Ширину боковой панели с деревом устройств можно изменять, перетаскивая разделитель.

Асинхронное взаимодействие: Использование asyncio и websockets для неблокирующей работы с сетью, что обеспечивает отзывчивость интерфейса.

Автоматическое переподключение: Встроенный механизм пытается автоматически восстановить потерянное WebSocket-соединение с каждым устройством.

Визуальный статус: Статус подключения каждого устройства (Подключено, Подключается, Ошибка, Отключено) наглядно отображается цветом в дереве устройств.

Встроенные настройки:

Добавление, изменение и удаление устройств производится прямо из интерфейса программы.

При указании локации для нового устройства используется выпадающий список с уже существующими локациями, что предотвращает опечатки.

Все настройки сохраняются в файл config.json и автоматически загружаются при следующем запуске.

Надежность: Программа автоматически создает шаблонный config.json при первом запуске и корректно обрабатывает ошибки парсинга.

Поддерживаемые устройства
1. Шторы (Curtain)

Панель управления позволяет:

Открывать, закрывать и останавливать движение.

Перемещать штору в заданную позицию с помощью слайдера.

Отображать текущее положение в процентах и времени, а также потребляемый ток.

Отображать статус калибровки и ошибки/статус связи с ПЧ (частотным преобразователем).

2. Вентиляция (Fan)

Панель управления позволяет:

Включать/выключать автоматический режим, который регулирует скорость в зависимости от температуры.

При отключенном авто-режиме:

Запускать и останавливать каждый вентилятор.

Устанавливать скорость для каждого вентилятора с помощью слайдера.

Сбрасывать ошибки вентиляторов.

Отображать общую информацию:

Текущую температуру.

Статус опрыскивания.

Тип используемого датчика и количество ошибок чтения.

Отображать детальную информацию для каждого из двух вентиляторов:

Текстовый статус и код ошибки.

Потребляемый ток.

Рабочую частоту (отображается корректно, с делением на 10).

Панель для второго вентилятора автоматически скрывается, если устройство сконфигурировано на работу с одним вентилятором.

Скриншот интерфейса (концепт)
Установка и запуск
1. Установка зависимостей

Для работы программы необходимы библиотеки customtkinter и websockets. Установите их с помощью pip:

Generated bash
pip install customtkinter websockets

2. Запуск программы

Просто запустите скрипт из командной строки:

Generated bash
python universal_gui.py
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Bash
IGNORE_WHEN_COPYING_END
3. Первый запуск и конфигурация

При первом запуске скрипт автоматически создаст в той же директории файл config.json с примерами устройств.

Запустите программу, нажмите на кнопку ⚙️ Настройки в правом верхнем углу.

В открывшемся окне вы можете удалить примеры и добавить свои реальные устройства.

Укажите Локацию, Имя, IP-адрес и Тип (curtain или fan) для каждого устройства.

Нажмите "Сохранить и перезапустить". Программа перезапустится с вашей новой конфигурацией.

Структура файла config.json

Файл конфигурации имеет простую структуру. Каждое устройство — это объект в списке devices, который должен содержать четыре поля:

Generated json
{
  "devices": [
    {
      "location": "Двор 1",
      "name": "Вентиляция в теплице",
      "ip": "192.168.1.130",
      "type": "fan"
    },
    {
      "location": "Дом",
      "name": "Штора в гостиной",
      "ip": "192.168.1.120",
      "type": "curtain"
    }
  ]
}
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Json
IGNORE_WHEN_COPYING_END

location: Название места установки (например, "Двор 1", "Дом", "Цех"). Используется для группировки в дереве.

name: Уникальное имя устройства в пределах одной локации.

ip: IP-адрес устройства.

type: Тип устройства. Должен быть "curtain" или "fan".

Архитектура кода

Код построен на принципах объектно-ориентированного программирования для обеспечения гибкости и расширяемости.

App: Главный класс приложения. Отвечает за создание основного окна, дерева локаций, обработку событий выбора в дереве и запуск/остановку всех процессов.

ConfigManager: Класс для работы с файлом config.json.

BaseController: Абстрактный базовый класс для всех контроллеров устройств. Реализует общую логику WebSocket-соединения, отправки команд и автоматического переподключения.

CurtainController / FanController: Дочерние классы, наследующиеся от BaseController. Каждый из них реализует свою уникальную логику парсинга входящих сообщений и формирования команд для своего типа устройства.

BaseDeviceFrame: Абстрактный базовый GUI-фрейм. Содержит общую логику для всех панелей управления.

CurtainControlFrame / FanControlFrame: Дочерние классы, отвечающие за создание и обновление виджетов для штор и вентиляторов соответственно.

SettingsWindow / DeviceEditDialog: Классы, реализующие интерфейс для управления конфигурацией.